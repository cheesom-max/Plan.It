<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AIê°€ ìƒì„±í•œ ë§ì¶¤í˜• ì—¬í–‰ ì¼ì •í‘œ">
    <title>ì—¬í–‰ ì¼ì • | Plan.It</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <!-- Auth & Database Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase.js" defer></script>
    <script src="auth.js" defer></script>
    <style>
        /* Itinerary Page Specific Styles */
        .itinerary-page {
            min-height: 100vh;
            background: linear-gradient(180deg, #e8f0ff 0%, var(--bg-light) 100%);
            padding-top: 80px;
        }

        .itinerary-page .navbar {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: var(--shadow-sm);
        }

        .itinerary-page .logo-text {
            color: var(--text-primary);
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            font-family: inherit;
            color: var(--text-secondary);
            background: var(--bg-card);
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius-lg);
            cursor: pointer;
            transition: var(--transition-normal);
        }

        .back-btn:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .itinerary-hero {
            background: var(--gradient-primary);
            padding: 3rem 2rem;
            text-align: center;
            color: var(--text-white);
            margin-bottom: -2rem;
            position: relative;
            z-index: 1;
        }

        .itinerary-hero::after {
            content: '';
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 30px solid transparent;
            border-right: 30px solid transparent;
            border-top: 20px solid var(--secondary-color);
        }

        .route-display {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .route-city {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius-lg);
            font-weight: 500;
        }

        .route-arrow {
            font-size: 1.25rem;
            opacity: 0.8;
        }

        .trip-meta {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1.5rem;
            font-size: 0.95rem;
            opacity: 0.9;
        }

        .trip-meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .itinerary-main {
            max-width: 900px;
            margin: 0 auto;
            padding: 4rem 2rem 3rem;
        }

        .itinerary-summary-card {
            background: var(--bg-card);
            border-radius: var(--border-radius-xl);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
            text-align: center;
        }

        .itinerary-summary-card h2 {
            font-size: 1.5rem;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
        }

        .itinerary-summary-card p {
            color: var(--text-secondary);
            line-height: 1.8;
        }

        .days-timeline {
            position: relative;
        }

        .days-timeline::before {
            content: '';
            position: absolute;
            left: 24px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, var(--primary-color), var(--accent-color));
            border-radius: 3px;
        }

        .timeline-day {
            position: relative;
            padding-left: 60px;
            margin-bottom: 2rem;
        }

        .timeline-dot {
            position: absolute;
            left: 12px;
            top: 0;
            width: 28px;
            height: 28px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-white);
            font-size: 0.85rem;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(0, 102, 255, 0.3);
            z-index: 1;
        }

        .timeline-card {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            transition: var(--transition-normal);
        }

        .timeline-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .no-itinerary {
            text-align: center;
            padding: 4rem 2rem;
            background: var(--bg-card);
            border-radius: var(--border-radius-xl);
            box-shadow: var(--shadow-md);
        }

        .no-itinerary-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .no-itinerary h2 {
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .no-itinerary p {
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .create-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 2rem;
            font-size: 1rem;
            font-weight: 600;
            font-family: inherit;
            color: var(--text-white);
            background: var(--gradient-primary);
            border: none;
            border-radius: var(--border-radius-lg);
            cursor: pointer;
            transition: var(--transition-normal);
            text-decoration: none;
        }

        .create-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 102, 255, 0.35);
        }

        .itinerary-footer-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 2px solid rgba(0, 0, 0, 0.05);
        }

        /* Print Styles */
        @media print {

            .navbar,
            .itinerary-footer-actions {
                display: none;
            }

            .itinerary-page {
                padding-top: 0;
            }

            .timeline-card {
                break-inside: avoid;
            }
        }
    </style>
</head>

<body class="itinerary-page">
    <!-- Navigation Bar -->
    <nav class="navbar scrolled">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <span class="logo-icon">âœˆï¸</span>
                <span class="logo-text">Plan.It</span>
            </a>
            <button class="back-btn" onclick="location.href='index.html'">
                <span>â†</span>
                <span>ìƒˆ ì¼ì • ë§Œë“¤ê¸°</span>
            </button>
        </div>
    </nav>

    <!-- Itinerary Hero -->
    <section class="itinerary-hero" id="itineraryHero">
        <h1 id="heroTitle">ğŸ—ºï¸ ì—¬í–‰ ì¼ì •</h1>
        <div class="route-display" id="routeDisplay">
            <!-- ì—¬í–‰ ê²½ë¡œê°€ ë™ì ìœ¼ë¡œ í‘œì‹œë¨ -->
        </div>
        <div class="trip-meta" id="tripMeta">
            <!-- ì—¬í–‰ ì •ë³´ê°€ í‘œì‹œë¨ -->
        </div>
    </section>

    <!-- Itinerary Content -->
    <main class="itinerary-main">
        <!-- Summary Card -->
        <div class="itinerary-summary-card" id="summaryCard">
            <h2 id="itineraryTitle">ì—¬í–‰ ì¼ì •</h2>
            <p id="itinerarySummary">AIê°€ ë§ì¶¤ ì„¤ê³„í•œ íŠ¹ë³„í•œ ì—¬í–‰ ì¼ì •ì…ë‹ˆë‹¤.</p>
        </div>

        <!-- Days Timeline -->
        <div class="days-timeline" id="daysTimeline">
            <!-- ì¼ë³„ ì¼ì •ì´ ë™ì ìœ¼ë¡œ í‘œì‹œë¨ -->
        </div>

        <!-- Travel Tips -->
        <div class="itinerary-tips" id="itineraryTips" style="display: none;">
            <!-- ì—¬í–‰ íŒì´ í‘œì‹œë¨ -->
        </div>

        <!-- No Itinerary State -->
        <div class="no-itinerary" id="noItinerary" style="display: none;">
            <div class="no-itinerary-icon">ğŸ“‹</div>
            <h2>ì•„ì§ ìƒì„±ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤</h2>
            <p>ì—¬í–‰ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  AIì—ê²Œ ë§ì¶¤ ì¼ì •ì„ ìš”ì²­í•´ë³´ì„¸ìš”!</p>
            <a href="index.html#travelForm" class="create-btn">
                <span>âœ¨</span>
                <span>ì¼ì • ìƒì„±í•˜ê¸°</span>
            </a>
        </div>

        <!-- Footer Actions -->
        <!-- Footer Actions (New: Share & Save) -->
        <div class="itinerary-footer-actions" id="footerActions">
            <button class="action-btn btn-share" id="shareBtn">
                <span>ğŸ”—</span>
                <span>ê³µìœ í•˜ê¸°</span>
            </button>
            <button class="action-btn btn-save" id="saveBtn">
                <span>ğŸ’¾</span>
                <span>ì €ì¥í•˜ê¸°</span>
            </button>
            <button class="action-btn btn-new-itinerary" onclick="location.href='index.html#travelForm'">
                <span>ğŸ”„</span>
                <span>ìƒˆ ì¼ì • ë§Œë“¤ê¸°</span>
            </button>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <p>&copy; 2026 Plan.It. All rights reserved.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', async function () {
            // ì „ì—­ ê°ì²´ ë§¤í•‘ (ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•˜ê¸° ìœ„í•¨)
            const Auth = window.Auth;
            const getSupabaseClient = () => window.supabaseClient;

            if (!Auth || !getSupabaseClient()) {
                console.warn('Auth or Supabase client not loaded yet. Waiting...');
                // í˜¹ì‹œ ëª¨ë¥¼ ë¡œë”© ì§€ì—° ëŒ€ë¹„ (ë³´í†µ defer ë¡œ í•´ê²°ë¨)
            }

            // localStorageì—ì„œ ì¼ì • ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
            const itineraryData = localStorage.getItem('travelItinerary');
            const tripInfo = JSON.parse(localStorage.getItem('tripInfo') || '{}');

            const heroTitle = document.getElementById('heroTitle');
            const routeDisplay = document.getElementById('routeDisplay');
            const tripMeta = document.getElementById('tripMeta');
            const summaryCard = document.getElementById('summaryCard');
            const daysTimeline = document.getElementById('daysTimeline');
            const itineraryTips = document.getElementById('itineraryTips');
            const noItinerary = document.getElementById('noItinerary');
            const footerActions = document.getElementById('footerActions');
            const shareBtn = document.getElementById('shareBtn');
            const saveBtn = document.getElementById('saveBtn');

            if (!itineraryData) {
                // ì¼ì •ì´ ì—†ìœ¼ë©´ ë¹ˆ ìƒíƒœ í‘œì‹œ
                summaryCard.style.display = 'none';
                daysTimeline.style.display = 'none';
                footerActions.style.display = 'none';
                document.getElementById('itineraryHero').style.display = 'none';
                noItinerary.style.display = 'block';
                return;
            }

            const itinerary = JSON.parse(itineraryData);

            // ì—¬í–‰ ê²½ë¡œ í‘œì‹œ
            if (tripInfo.destinations && tripInfo.destinations.length > 0) {
                routeDisplay.innerHTML = tripInfo.destinations.map((dest, i) => {
                    const arrow = i < tripInfo.destinations.length - 1 ? '<span class="route-arrow">â†’</span>' : '';
                    // destê°€ ê°ì²´ì¸ì§€ ë¬¸ìì—´ì¸ì§€ í™•ì¸
                    const name = typeof dest === 'object' ? (dest.displayName || dest.name) : dest;
                    return `<span class="route-city">ğŸ“ ${name}</span>${arrow}`;
                }).join('');
            }

            // ì—¬í–‰ ì •ë³´ ë©”íƒ€ í‘œì‹œ
            if (tripInfo.startDate && tripInfo.endDate) {
                const days = Math.ceil((new Date(tripInfo.endDate) - new Date(tripInfo.startDate)) / (1000 * 60 * 60 * 24)) + 1;
                tripMeta.innerHTML = `
                    <span class="trip-meta-item">ğŸ“… ${tripInfo.startDate} ~ ${tripInfo.endDate}</span>
                    <span class="trip-meta-item">â±ï¸ ${days}ì¼</span>
                `;
            }

            // ì œëª©ê³¼ ìš”ì•½ ì—…ë°ì´íŠ¸
            if (itinerary.title) {
                document.getElementById('itineraryTitle').textContent = itinerary.title;
                heroTitle.textContent = `ğŸ—ºï¸ ${itinerary.title}`;
            }
            if (itinerary.summary) {
                document.getElementById('itinerarySummary').textContent = itinerary.summary;
            }

            // ì¼ë³„ ì¼ì • íƒ€ì„ë¼ì¸ í‘œì‹œ
            if (itinerary.days && itinerary.days.length > 0) {
                daysTimeline.innerHTML = itinerary.days.map(day => `
                    <div class="timeline-day">
                        <div class="timeline-dot">${day.day}</div>
                        <div class="timeline-card">
                            <div class="day-header">
                                <div class="day-number">Day ${day.day}</div>
                                <div class="day-info">
                                    <h3>${day.date || `Day ${day.day}`}</h3>
                                    <p>${day.location || ''}</p>
                                </div>
                            </div>
                            <div class="day-schedule">
                                ${day.schedule.map(item => renderScheduleItem(item)).join('')}
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            // ìŠ¤ì¼€ì¤„ ì•„ì´í…œ ë Œë”ë§ í•¨ìˆ˜ (ì¼ë°˜ í™œë™ vs ë§›ì§‘ ë¶„ê¸°)
            function renderScheduleItem(item) {
                // ë§›ì§‘(3 options)ì¸ ê²½ìš°
                if ((item.type === 'food' || item.category === 'ë§›ì§‘íƒë°©') && item.options) {
                    return `
                        <div class="schedule-item food-item">
                            <div class="schedule-time">${item.time} <span class="badge-food">ğŸ½ï¸ ${item.meal_type || 'ì‹ì‚¬'}</span></div>
                            <div class="schedule-content">
                                ${renderTravelInfo(item)}
                                <div class="food-options-grid">
                                    ${item.options.map((opt, idx) => `
                                        <div class="food-option-card">
                                            <div class="food-rank">Option ${idx + 1}</div>
                                            <div class="food-name">${opt.name}</div>
                                            <div class="food-meta">â­ ${opt.rating || opt.rating_expect || '4.0'} | ${opt.signature_menu || opt.menu || 'ëŒ€í‘œ ë©”ë‰´'}</div>
                                            <div class="food-desc">"${opt.features || opt.description || opt.atmosphere}"</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                }

                // ì¼ë°˜ í™œë™ì¸ ê²½ìš°
                const placeName = typeof item.place === 'object' ? item.place.name_ko : (item.place || item.activity || 'ì¥ì†Œ');
                const categoryLabel = item.category ? `${item.category_icon || ''} ${item.category}` : getTypeLabel(item.type);

                return `
                    <div class="schedule-item">
                        <div class="schedule-time">${item.time}</div>
                        <div class="schedule-content">
                            <div class="schedule-header">
                                <span class="schedule-place">${placeName}</span>
                                <span class="schedule-type">${categoryLabel}</span>
                            </div>
                            <div class="schedule-description">${item.description}</div>
                            ${renderTravelInfo(item)}
                        </div>
                    </div>
                `;
            }

            function renderTravelInfo(item) {
                let html = '';

                // 1. ê±°ë¦¬/ì´ë™ ì •ë³´ (New Schema)
                if (item.distance_from_previous) {
                    const dist = item.distance_from_previous;
                    html += `<div class="travel-info-text">ğŸš— ${dist.travel_method} ${dist.travel_time} (${dist.value}${dist.unit})</div>`;
                }
                // 2. ì´ë™ ìƒì„¸ (New Schema)
                else if (item.travel_info && typeof item.travel_info === 'object') {
                    html += `<div class="travel-info-text">ğŸ‘£ ${item.travel_info.method} (${item.travel_info.detail})</div>`;
                }
                // 3. ê¸°ì¡´ ë°©ì‹ (fallback)
                else if (item.travel_info) {
                    html += `<div class="travel-info-text">ğŸ‘£ ${item.travel_info}</div>`;
                }

                return html;
            }

            // ì—¬í–‰ íŒ í‘œì‹œ
            if (itinerary.tips && itinerary.tips.length > 0) {
                itineraryTips.style.display = 'block';
                itineraryTips.innerHTML = `
                    <h4>ğŸ’¡ ì—¬í–‰ íŒ</h4>
                    <ul>
                        ${itinerary.tips.map(tip => `<li>${tip}</li>`).join('')}
                    </ul>
                `;
            }

            // ===== ê¸°ëŠ¥ êµ¬í˜„: ê³µìœ í•˜ê¸° & ì €ì¥í•˜ê¸° =====

            // 1. ê³µìœ í•˜ê¸°
            shareBtn.addEventListener('click', async function () {
                const shareData = {
                    title: `Plan.It - ${itinerary.title}`,
                    text: `AIê°€ ì„¤ê³„í•´ì¤€ ${itinerary.title} ì—¬í–‰ ì¼ì •ì…ë‹ˆë‹¤!\n\n${itinerary.summary}`,
                    url: window.location.href // í˜„ì¬ URL ê³µìœ 
                };

                try {
                    if (navigator.share) {
                        await navigator.share(shareData);
                    } else {
                        // Web Share API ë¯¸ì§€ì› ì‹œ í´ë¦½ë³´ë“œ ë³µì‚¬
                        await navigator.clipboard.writeText(`${shareData.title}\n${shareData.text}\n${shareData.url}`);
                        alert('ğŸ“‹ ì—¬í–‰ ì¼ì •ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    }
                } catch (err) {
                    console.error('ê³µìœ  ì‹¤íŒ¨:', err);
                }
            });

            // 2. ì €ì¥í•˜ê¸° (DB ì—°ë™ - ì „ì²´ ë°ì´í„° ì €ì¥)
            saveBtn.addEventListener('click', async function () {
                const originalText = saveBtn.innerHTML;
                saveBtn.innerHTML = '<span>â³</span><span>ì €ì¥ ì¤‘...</span>';
                saveBtn.disabled = true;

                try {
                    // ë¡œê·¸ì¸ ì²´í¬
                    const session = await Auth.getSession();
                    if (!session || !session.user) {
                        if (confirm('ğŸ”’ ì—¬í–‰ì„ ì €ì¥í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.\në¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                            window.location.href = 'index.html?action=login';
                        }
                        return;
                    }

                    const supabase = getSupabaseClient();
                    const userId = session.user.id;

                    // 1. Trips í…Œì´ë¸” ì €ì¥
                    const { data: tripData, error: tripError } = await supabase
                        .from('trips')
                        .insert({
                            user_id: userId,
                            title: itinerary.title || 'ë‚˜ë§Œì˜ ì—¬í–‰',
                            destination: tripInfo.destinations.map(d => typeof d === 'object' ? d.name : d).join(', '),
                            start_date: tripInfo.startDate,
                            end_date: tripInfo.endDate,
                            companion: tripInfo.companion || 'alone',
                            styles: tripInfo.styles || ['basic'],
                            status: 'completed'
                        })
                        .select()
                        .single();

                    if (tripError) throw tripError;
                    const tripId = tripData.id;

                    // 2. ìƒì„¸ ì¼ì • ì €ì¥ (Days & Items)
                    if (itinerary.days && itinerary.days.length > 0) {
                        for (const day of itinerary.days) {
                            // Trip_Days ì €ì¥
                            const { data: dayData, error: dayError } = await supabase
                                .from('trip_days')
                                .insert({
                                    trip_id: tripId,
                                    day_number: day.day,
                                    date: day.date, // YYYY-MM-DD
                                    title: day.day_theme || `Day ${day.day}`,
                                    summary: day.location || ''
                                })
                                .select()
                                .single();

                            if (dayError) throw dayError;
                            const dayId = dayData.id;

                            // Trip_Items ì €ì¥
                            if (day.schedule && day.schedule.length > 0) {
                                const itemsToInsert = day.schedule.map((item, index) => {
                                    // ì¥ì†Œëª… ì¶”ì¶œ
                                    const placeName = typeof item.place === 'object' ? item.place.name_ko : (item.place || item.activity || 'ì¥ì†Œ');
                                    // ì£¼ì†Œ ì¶”ì¶œ
                                    const address = typeof item.place === 'object' ? item.place.address : null;
                                    // ì¹´í…Œê³ ë¦¬ ë§¤í•‘
                                    const categoryEnum = mapCategoryToEnum(item.category || item.type);

                                    return {
                                        trip_day_id: dayId,
                                        order_index: index + 1,
                                        time: item.time, // "14:00" format compatible with TIME type
                                        place_name: placeName,
                                        category: categoryEnum,
                                        description: item.description,
                                        address: address,
                                        duration_minutes: parseDuration(item.duration),
                                        image_url: null // ì¶”í›„ ì´ë¯¸ì§€ê°€ ìˆë‹¤ë©´ ì¶”ê°€
                                    };
                                });

                                const { error: itemsError } = await supabase
                                    .from('trip_items')
                                    .insert(itemsToInsert);

                                if (itemsError) throw itemsError;
                            }
                        }
                    }

                    alert('âœ… ì—¬í–‰ ì¼ì •ì´ ë‚´ ê³„ì •ì— ì™„ë²½í•˜ê²Œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');

                } catch (error) {
                    console.error('ì €ì¥ ì˜¤ë¥˜ ìƒì„¸:', error);
                    alert(`âŒ ì €ì¥ ì‹¤íŒ¨: ${error.message}`);
                } finally {
                    saveBtn.innerHTML = originalText;
                    saveBtn.disabled = false;
                }
            });

            // Helper: ì¹´í…Œê³ ë¦¬ ë§¤í•‘ (DB ENUM í˜¸í™˜)
            function mapCategoryToEnum(koreanCategory) {
                const map = {
                    'ë§›ì§‘íƒë°©': 'food', 'food': 'food',
                    'íœ´ì–‘': 'relax', 'relax': 'relax',
                    'ì•¡í‹°ë¹„í‹°': 'activity', 'activity': 'activity',
                    'ë¬¸í™”ì˜ˆìˆ ': 'culture', 'culture': 'culture',
                    'ì‡¼í•‘': 'shopping', 'shopping': 'shopping',
                    'ìì—°íƒí—˜': 'nature', 'nature': 'nature',
                    'í¬í† ìŠ¤íŒŸ': 'photo', 'photo': 'photo',
                    'ë‚˜ì´íŠ¸ë¼ì´í”„': 'nightlife', 'nightlife': 'nightlife',
                    'êµí†µ': 'transport', 'transport': 'transport',
                    'ìˆ™ì†Œ': 'accommodation', 'accommodation': 'accommodation'
                };
                return map[koreanCategory] || 'other';
            }

            // Helper: ì‹œê°„ íŒŒì‹± ("2ì‹œê°„" -> 120, "1ì‹œê°„ 30ë¶„" -> 90)
            function parseDuration(durationStr) {
                if (!durationStr) return null;
                let minutes = 0;

                const hourMatch = durationStr.match(/(\d+)ì‹œê°„/);
                if (hourMatch) minutes += parseInt(hourMatch[1]) * 60;

                const minMatch = durationStr.match(/(\d+)ë¶„/);
                if (minMatch) minutes += parseInt(minMatch[1]);

                return minutes > 0 ? minutes : null;
            }

            function getTypeLabel(type) {
                const labels = {
                    food: 'ğŸ½ï¸ ë§›ì§‘',
                    activity: 'ğŸ„ ì•¡í‹°ë¹„í‹°',
                    culture: 'ğŸ­ ë¬¸í™”',
                    nature: 'ğŸŒ¿ ìì—°',
                    shopping: 'ğŸ›ï¸ ì‡¼í•‘',
                    transport: 'ğŸš— ì´ë™'
                };
                return labels[type] || type;
            }
        });
    </script>
</body>

</html>